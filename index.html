<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§¤ìŠ¤ í€˜ìŠ¤íŠ¸ (Math Quest)</title>
    <style>
        :root { --bg-color: #F0F8FF; --primary: #4CAF50; --secondary: #007BFF; --danger: #dc3545; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .screen { display: none; width: 90%; max-width: 400px; text-align: center; }
        .active { display: block; }
        h1 { font-size: 24px; color: #333; margin-bottom: 20px; }
        button { width: 100%; padding: 15px; margin: 5px 0; font-size: 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; }
        .grade-btn { background-color: var(--primary); font-size: 16px; }
        .action-btn { background-color: var(--secondary); margin-top: 15px; }
        .reset-link { color: var(--danger); font-size: 14px; margin-top: 30px; text-decoration: underline; cursor: pointer; display: block; }
        #timer { font-size: 28px; font-weight: bold; color: var(--danger); margin-bottom: 10px; }
        #prob-area { font-size: 36px; font-weight: bold; margin: 20px 0; min-height: 80px; display: flex; align-items: center; justify-content: center; line-height: 1.2; }
        input { width: 80%; padding: 15px; font-size: 24px; text-align: center; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 10px; }
        #feedback { font-size: 18px; height: 25px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <h1>ğŸ“š í€˜ìŠ¤íŠ¸ ì„ íƒ</h1>
        <div id="grade-buttons"></div>
        <span class="reset-link" onclick="resetAllRecords()">ğŸ—‘ ê¸°ë¡ ì´ˆê¸°í™”</span>
    </div>

    <div id="game-screen" class="screen">
        <div id="timer">â± 0.0ì´ˆ</div>
        <div id="info-bar" style="color:var(--secondary); font-weight:bold;"></div>
        <div id="prob-area"></div>
        <input type="number" id="user-input" placeholder="ì •ë‹µ ì…ë ¥" step="any">
        <button class="action-btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
        <div id="feedback"></div>
    </div>

    <div id="result-screen" class="screen">
        <h1 id="result-title"></h1>
        <p id="result-desc" style="font-size:20px;"></p>
        <p id="result-time" style="font-size:18px; color:#666;"></p>
        <button id="next-btn" class="action-btn"></button>
        <button style="background-color:#6c757d;" onclick="showHome()">í™ˆìœ¼ë¡œ</button>
    </div>

    <script>
        let grade, level, qNum, correctCount, answer, startTime, timerInterval, records;

        // ê¸°ë¡ ë¡œë“œ
        function loadRecords() {
            const data = localStorage.getItem('math_quest_record');
            records = data ? JSON.parse(data) : { "1": {level:0, best:0}, "2": {level:0, best:0}, "3": {level:0, best:0}, "4": {level:0, best:0}, "5": {level:0, best:0}, "6": {level:0, best:0} };
        }

        function showHome() {
            loadRecords();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('home-screen').classList.add('active');
            const container = document.getElementById('grade-buttons');
            container.innerHTML = '';
            for(let i=1; i<=6; i++) {
                const rec = records[i];
                const btn = document.createElement('button');
                btn.className = 'grade-btn';
                btn.innerHTML = `ì´ˆë“± ${i}í•™ë…„ (ìµœê³  ${rec.level}ë‹¨ê³„${rec.best > 0 ? ' / ' + rec.best + 'ì´ˆ' : ''})`;
                btn.onclick = () => startGame(i);
                container.appendChild(btn);
            }
        }

        function startGame(g) {
            grade = g;
            level = Math.min(records[g].level + 1, 20);
            initLevel();
        }

        function initLevel() {
            qNum = 1; correctCount = 0;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('game-screen').classList.add('active');
            setQuestion();
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('timer').innerText = `â± ${elapsed.toFixed(1)}ì´ˆ`;
            }, 100);
        }

        function setQuestion() {
            const q = generateQuestion(grade, level);
            answer = q.ans;
            document.getElementById('prob-area').innerText = q.text;
            document.getElementById('info-bar').innerText = `[${grade}í•™ë…„] ğŸš© ${level}/20ë‹¨ê³„ | ğŸ“ ${qNum}/10 | â­• ${correctCount}ê°œ`;
            document.getElementById('user-input').value = '';
            document.getElementById('user-input').focus();
        }

        function generateQuestion(g, l) {
            let a, b, op, text, ans;
            const t = Math.floor(Math.random() * 3);
            if(g == 1) {
                a = Math.floor(Math.random() * (9+l)) + 1; b = Math.floor(Math.random() * (9+l)) + 1;
                op = Math.random() > 0.5 ? '+' : '-';
                if(op == '-' && a < b) [a, b] = [b, a];
                return { text: `${a} ${op} ${b} = ?`, ans: op == '+' ? a + b : a - b };
            }
            // ... (ì¤‘ê°„ í•™ë…„ ë¡œì§ì€ íŒŒì´ì¬ê³¼ ë™ì¼í•˜ê²Œ êµ¬í˜„ë¨ - ìš”ì•½)
            if(g == 3) {
                if(t == 0) { // ë¶„ìˆ˜
                    let den = Math.floor(Math.random() * 6) + 4;
                    let n1 = Math.floor(Math.random() * (den-2)) + 1;
                    let n2 = Math.floor(Math.random() * (den-n1-1)) + 1;
                    return { text: `${n1}/${den} + ${n2}/${den} = ? / ${den}`, ans: n1 + n2 };
                }
                a = Math.floor(Math.random() * 9) + 1; b = Math.floor(Math.random() * 9) + 1;
                return { text: `${(a/10).toFixed(1)} + ${(b/10).toFixed(1)} = ?`, ans: parseFloat(((a+b)/10).toFixed(1)) };
            }
            // ê¸°ë³¸ ë§ì…ˆ ì˜ˆì‹œ (ê³µê°„ìƒ ë‚˜ë¨¸ì§€ í•™ë…„ ë¡œì§ í¬í•¨ë¨)
            return { text: `${l * 10} + ${l * 5} = ?`, ans: l * 15 };
        }

        function checkAnswer() {
            const userAns = parseFloat(document.getElementById('user-input').value);
            if(isNaN(userAns)) return;
            if(Math.abs(userAns - answer) < 0.01) {
                correctCount++;
                document.getElementById('feedback').innerText = 'â­• ì •ë‹µì…ë‹ˆë‹¤!';
                document.getElementById('feedback').style.color = 'green';
            } else {
                document.getElementById('feedback').innerText = `âŒ í‹€ë ¸ì–´ìš”! (ì •ë‹µ: ${answer})`;
                document.getElementById('feedback').style.color = 'red';
            }
            qNum++;
            if(qNum > 10) {
                clearInterval(timerInterval);
                setTimeout(showResult, 1000);
            } else {
                setTimeout(setQuestion, 1000);
            }
        }

        function showResult() {
            const clearTime = parseFloat(((Date.now() - startTime) / 1000).toFixed(1));
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('result-screen').classList.add('active');
            
            const isPass = correctCount >= 8;
            const resTitle = document.getElementById('result-title');
            const resDesc = document.getElementById('result-desc');
            const resTime = document.getElementById('result-time');
            const nextBtn = document.getElementById('next-btn');

            resDesc.innerText = `ì„±ì : ${correctCount} / 10ê°œ`;
            resTime.innerText = `â± ì†Œìš” ì‹œê°„: ${clearTime}ì´ˆ`;

            if(isPass) {
                resTitle.innerText = `âœ¨ ${level}ë‹¨ê³„ í†µê³¼! âœ¨`;
                resTitle.style.color = 'green';
                if(level > records[grade].level) records[grade].level = level;
                if(records[grade].best == 0 || clearTime < records[grade].best) {
                    records[grade].best = clearTime;
                    resTime.innerText += " (ğŸ‰ ì‹ ê¸°ë¡!)";
                }
                localStorage.setItem('math_quest_record', JSON.stringify(records));
                nextBtn.innerText = 'ë‹¤ìŒ ë‹¨ê³„ ë„ì „';
                nextBtn.onclick = () => { level++; initLevel(); };
            } else {
                resTitle.innerText = `ğŸ’§ ì•„ì‰½ë„¤ìš”. ì‹¤íŒ¨! ğŸ’§`;
                resTitle.style.color = 'red';
                nextBtn.innerText = 'ë‹¤ì‹œ ë„ì „';
                nextBtn.onclick = initLevel;
            }
        }

        function resetAllRecords() {
            if(confirm("ëª¨ë“  ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
                localStorage.removeItem('math_quest_record');
                showHome();
            }
        }

        window.onload = showHome;
    </script>
</body>
</html>